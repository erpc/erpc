---
description: Consensus policy is used to enforce block/logs data integrity and consistency across multiple RPC nodes...
---

import { Callout, Tabs, Tab } from "nextra/components";

# Consensus

When requesting block, trace or logs data from RPC nodes, there's no guarantee that the responding node has the most recent data.

## How does eRPC handle data integrity?

There are three main mechanisms that aim to keep the data integrity as high as possible:

1. **Retry directives** such as "[retry-empty](/operation/directives#retry-empty-responses)" or "[retry-pending](/operation/directives#retry-pending-transactions)" where request will be sent to another node if one returns an empty or pending response.

1. **Tip of the chain tracking** which is a component (e.g. evm state poller) running for every Upstream, which tracks latest/finalized blocks and syncing state of the chain. eRPC will intercept certain methods (e.g. `eth_blockNumber` or `eth_getBlockByNumber(latest)`) and ensures the highest known block number is returned. This behavior is essential for use-cases like "indexers" so that they always receive a highest known block number.

2. **Consensus policy** as described below eRPC provides an optional `consensus` failsafe policy to ensure data integrity and consistency across multiple RPC nodes by sending more requests and comparing the results.


## Config

This failsafe policy must be defined on [Network](/config/projects/networks)-level.

```yaml filename="erpc.yaml"
projects:
  - id: main
    networks:
      - type: evm
        evm:
          chainId: 137
        failsafe:
          consensus:
            # Number of participants required to reach consensus with a minimum agreement
            requiredParticipants: 3
            agreementThreshold: 2

            # returnError | acceptAnyValidResult | preferBlockHeadLeader | onlyBlockHeadLeader
            failureBehavior: onlyBlockHeadLeader
            # returnError | acceptAnyValidResult | preferBlockHeadLeader | onlyBlockHeadLeader
            disputeBehavior: preferBlockHeadLeader
            # returnError | acceptAnyValidResult | preferBlockHeadLeader | onlyBlockHeadLeader
            lowParticipantsBehavior: preferBlockHeadLeader

            # If an upstream constantly is on the wrong-side of the consensus, it will sit-out for a period of time.
            punishMisbehavior:
              disputeThreshold: 100
              sitOutPenalty: 30m
```

#### Roadmap

On some doc pages we like to share our ideas for related future implementations, feel free to open a PR if you're up for a challenge:

<br />
- [ ] Allow defining failsafe policies on a per-method basis (e.g. different behavior for eth_getLogs vs other methods).
